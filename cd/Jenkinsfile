DEV_PROJ = 'csaa-dev'
STAGE_DIR = '/tmp/workspace/myapp/'


pipeline {
    
    agent {
        label 'csaa-agent'
    }
    

    stages{


 
        
      stage("Deploy Application Image"){
            steps{
              container("jnlp"){
                 
            script {
              openshift.withCluster() {
                openshift.withProject("${DEV_PROJ}") {
                              // Deploy the development application.
                 def dcdev = openshift.selector("dc", "myapp").object()
                //dcdev.spec.template.spec.containers[0].env[0].value="${devTag} (task-dev)"
                //openshift.apply(dcdev)
               openshift.selector("dc", "tasks").rollout().latest();

          // Wait for application to be deployed
         // def dc = openshift.selector("dc", "tasks").object()
          def dc_version = dcdev.status.latestVersion
          def rc = openshift.selector("rc", "myapp-${dc_version}").object()

          echo "Waiting for ReplicationController app-${dc_version} to be ready"
          while (rc.spec.replicas != rc.status.readyReplicas) {
            sleep 5
            rc = openshift.selector("rc", "myapp-${dc_version}").object()
          }
                  
        
                  }
                }
             } 
        
           }
                
            }
        } //end of stage
                
    

    }//end of stages
}//end of pipeline
